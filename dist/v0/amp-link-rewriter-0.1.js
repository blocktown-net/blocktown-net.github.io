(self.AMP=self.AMP||[]).push({n:"amp-link-rewriter",v:"1910151804560",f:(function(AMP,_){
var m="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},p;if("function"==typeof Object.setPrototypeOf)p=Object.setPrototypeOf;else{var r;a:{var t={a:!0},v={};try{v.__proto__=t;r=v.a;break a}catch(a){}r=!1}p=r?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var w=p;(function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a})(this);function x(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(d){return b}};var z=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var A=self.__AMP_LOG;function B(a){A.user||(A.user=C());var b=A.user.win;return a&&a.ownerDocument.defaultView!=b?A.userForEmbed?A.userForEmbed:A.userForEmbed=C():A.user}function C(){throw Error("failed to call initLogConstructor");};var D=Object.prototype.hasOwnProperty;function E(a){var b="";try{"localStorage"in a&&(b=a.localStorage.getItem("amp-experiment-toggles"))}catch(f){if(A.dev)a=A.dev;else throw Error("failed to call initLogConstructor");a.warn("EXPERIMENTS","Failed to retrieve experiments from localStorage.")}var d=b?b.split(/\s*,\s*/g):[];a=Object.create(null);for(var c=0;c<d.length;c++)0!=d[c].length&&("-"==d[c][0]?a[d[c].substr(1)]=!1:a[d[c]]=!0);return a};function G(a,b){var d=H(a);d=I(d);return J(d,b)}function H(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView;b=b.__AMP_TOP||(b.__AMP_TOP=b);a=J(b,"ampdoc").getAmpDoc(a)}return a}function I(a){a=H(a);return a.isSingleDoc()?a.win:a}function J(a,b){K(a,b);var d=a.__AMP_SERVICES;d||(d=a.__AMP_SERVICES={});var c=d;a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
function K(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
var L;function M(a){var b=void 0,d=N,c=b||function(a){return a},f=a.dataset;a={};var h=d?d:/^param(.+)/,q;for(q in f){var e=q.match(h);if(e){var k=e[1][0].toLowerCase()+e[1].substr(1);a[c(k)]=f[q]}}return a}function O(a,b){for(var d=a.length,c=0;c<d;c++)b(a[c],c)};function P(a){var b={};Object.keys(a).forEach(function(d){b[d]="^"+a[d]+"$"});return b};function Q(a,b){var d=a.getRootNode(),c=b.section.join(" a, "),f=d.querySelectorAll("a"),h=[];0!==b.section.length&&(c+=" a",f=d.querySelectorAll(c));O(f,function(a){R(a,b)&&h.push(a)});return h}function R(a,b){var d=b.attribute,c=Object.keys(d);return c.every(function(b){var c=new RegExp(d[b]);return c.test(a.getAttribute(b))})};var S=["href","id","rel","rev"],N=/^vars(.+)/,T=/^(?:https?:)?(?:\/\/)?([^\/?]+)/i,aa={SOURCE_URL:!0,DOCUMENT_REFERRER:!0};
function V(a,b,d){this.h=d;d=b;try{/^[\w-]+$/.test("script");if(void 0!==L)var c=L;else{try{var f=d.ownerDocument,h=f.createElement("div"),q=f.createElement("div");h.appendChild(q);var e=h.querySelector(":scope div")===q}catch(F){e=!1}c=L=e}if(c)var k=d.querySelectorAll("> script".replace(/^|,/g,"$&:scope "));else{d.classList.add("i-amphtml-scoped");var U="> script".replace(/^|,/g,"$&.i-amphtml-scoped "),ba=d.querySelectorAll(U);d.classList.remove("i-amphtml-scoped");k=ba}var u=k;if(1!==u.length)throw Error("Found "+
u.length+" <script> children. Expected 1.");var y=u[0];if("SCRIPT"!=y.tagName||!y.hasAttribute("type")||"APPLICATION/JSON"!=y.getAttribute("type").toUpperCase())throw Error('<script> child must have type="application/json"');try{var n=JSON.parse(y.textContent)}catch(F){throw Error("Failed to parse <script> contents. Is it valid JSON?");}var l=n}catch(F){throw B(d).createError("%s: %s","amp-link-rewriter",F);}n=l.output;B().assert(n,"amp-link-rewriter: output config property is required",void 0,void 0,
void 0,void 0,void 0,void 0,void 0,void 0,void 0);this.l={output:l.output.toString(),section:D.call(l,"section")?l.section:[],attribute:D.call(l,"attribute")?P(l.attribute):{},vars:D.call(l,"vars")?l.vars:{}};this.m=Q(this.h,this.l);this.j=a;this.c="";l=b;n=l.ownerDocument.defaultView;c=n.__AMP_TOP||(n.__AMP_TOP=n);u=n!=c;if(c.__AMP__EXPERIMENT_TOGGLES)var g=c.__AMP__EXPERIMENT_TOGGLES;else{c.__AMP__EXPERIMENT_TOGGLES=Object.create(null);k=c.__AMP__EXPERIMENT_TOGGLES;if(c.AMP_CONFIG)for(g in c.AMP_CONFIG)e=
c.AMP_CONFIG[g],"number"===typeof e&&0<=e&&1>=e&&(k[g]=Math.random()<e);if(c.AMP_CONFIG&&Array.isArray(c.AMP_CONFIG["allow-doc-opt-in"])&&0<c.AMP_CONFIG["allow-doc-opt-in"].length&&(g=c.AMP_CONFIG["allow-doc-opt-in"],e=c.document.head.querySelector('meta[name="amp-experiments-opt-in"]')))for(e=e.getAttribute("content").split(","),f=0;f<e.length;f++)-1!=g.indexOf(e[f])&&(k[e[f]]=!0);Object.assign(k,E(c));if(c.AMP_CONFIG&&Array.isArray(c.AMP_CONFIG["allow-url-opt-in"])&&0<c.AMP_CONFIG["allow-url-opt-in"].length){g=
c.AMP_CONFIG["allow-url-opt-in"];e=c.location.originalHash||c.location.hash;c=Object.create(null);if(e)for(;h=z.exec(e);)f=x(h[1],h[1]),h=h[2]?x(h[2].replace(/\+/g," "),h[2]):"",c[f]=h;for(e=0;e<g.length;e++)f=c["e-"+g[e]],"1"==f&&(k[g[e]]=!0),"0"==f&&(k[g[e]]=!1)}g=k}g=!!g["ampdoc-fie"];u&&!g?g=K(n,"url-replace")?J(n,"url-replace"):null:(g=H(l),g=I(g),g=K(g,"url-replace")?J(g,"url-replace"):null);this.B=g}
V.prototype.handleClick=function(a){if(a&&(this.c=this.l.output,a.href.match(T)[1]!==this.c.match(T)[1]&&ca(this,a))){var b=G(this.h,"documentInfo").get().sourceUrl.match(T)[1],d=G(this.h,"documentInfo").get().canonicalUrl.match(T)[1];if(!da(a,[b,d])){var c=a;this.c=this.B.expandUrlSync(this.c,{DOCUMENT_REFERRER:this.j},void 0,aa);var f=this.l.vars;f instanceof Object&&(c.href=ea(this,c,f))}}};
function ca(a,b){if(null===a.m||0===a.m.length)return!0;var d=a.m.filter(function(a){return a===b});return 0<d.length?!0:!1}function da(a,b){var d=a.href;return b.some(function(a){var b=d.match(T);return b?T.test(d)&&b[1]===a:!0})}
function ea(a,b,d){S.forEach(function(a){b.getAttribute(a)&&(d[a]=b.getAttribute(a))});var c=M(b);Object.assign(d,c);d.random=Math.random().toString(32).substr(2);Object.keys(d).forEach(function(b){d[b]&&(a.c=a.c.replace("${"+b+"}",encodeURIComponent(d[b])))});a.c=a.c.replace(/\${[A-Za-z0-9]+}+/,function(){return""});return a.c};function W(a){a=AMP.BaseElement.call(this,a)||this;a.h=a.getAmpDoc();a.o=null;a.j="";a.A=G(a.h,"navigation");return a}var X=AMP.BaseElement;W.prototype=m(X.prototype);W.prototype.constructor=W;if(w)w(W,X);else for(var Y in X)if("prototype"!=Y)if(Object.defineProperties){var Z=Object.getOwnPropertyDescriptor(X,Y);Z&&Object.defineProperty(W,Y,Z)}else W[Y]=X[Y];W.C=X.prototype;
W.prototype.buildCallback=function(){var a=this,b=G(this.h,"viewer");return this.h.whenReady().then(function(){return b.getReferrerUrl()}).then(function(b){return a.j=b}).then(this.w.bind(this))};W.prototype.w=function(){this.o=new V(this.j,this.element,this.h);fa(this)};function fa(a){a.A.registerAnchorMutator(function(b){a.o.handleClick(b)},0)}W.prototype.isLayoutSupported=function(a){return"nodisplay"===a};(function(a){a.registerElement("amp-link-rewriter",W)})(self.AMP);
})});

//# sourceMappingURL=amp-link-rewriter-0.1.js.map
