(self.AMP=self.AMP||[]).push({n:"amp-viewer-assistance",v:"1910151804560",f:(function(AMP,_){
function h(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var k=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var l=self.__AMP_LOG;function m(){if(!l.user)throw Error("failed to call initLogConstructor");return l.user};function n(a){return a||{}};n({c:!0,v:!0,a:!0,ad:!0,action:!0});function p(a,b){if(a.__AMP__EXPERIMENT_TOGGLES)var c=a.__AMP__EXPERIMENT_TOGGLES;else{a.__AMP__EXPERIMENT_TOGGLES=Object.create(null);c=a.__AMP__EXPERIMENT_TOGGLES;if(a.AMP_CONFIG)for(var d in a.AMP_CONFIG){var e=a.AMP_CONFIG[d];"number"===typeof e&&0<=e&&1>=e&&(c[d]=Math.random()<e)}if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-doc-opt-in"])&&0<a.AMP_CONFIG["allow-doc-opt-in"].length&&(d=a.AMP_CONFIG["allow-doc-opt-in"],e=a.document.head.querySelector('meta[name="amp-experiments-opt-in"]'))){e=
e.getAttribute("content").split(",");for(var f=0;f<e.length;f++)-1!=d.indexOf(e[f])&&(c[e[f]]=!0)}Object.assign(c,q(a));if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-url-opt-in"])&&0<a.AMP_CONFIG["allow-url-opt-in"].length){d=a.AMP_CONFIG["allow-url-opt-in"];e=a.location.originalHash||a.location.hash;a=Object.create(null);if(e)for(var g;g=k.exec(e);)f=h(g[1],g[1]),g=g[2]?h(g[2].replace(/\+/g," "),g[2]):"",a[f]=g;for(e=0;e<d.length;e++)f=a["e-"+d[e]],"1"==f&&(c[d[e]]=!0),"0"==f&&(c[d[e]]=!1)}}var z=
c;return!!z[b]}function q(a){var b="";try{"localStorage"in a&&(b=a.localStorage.getItem("amp-experiment-toggles"))}catch(e){if(l.dev)a=l.dev;else throw Error("failed to call initLogConstructor");a.warn("EXPERIMENTS","Failed to retrieve experiments from localStorage.")}var c=b?b.split(/\s*,\s*/g):[];a=Object.create(null);for(var d=0;d<c.length;d++)0!=c[d].length&&("-"==c[d][0]?a[c[d].substr(1)]=!1:a[c[d]]=!0);return a};function r(a){var b=a.ownerDocument.defaultView,c=b.__AMP_TOP||(b.__AMP_TOP=b),d=b!=c,e=p(c,"ampdoc-fie");d&&!e?a=t(b,"action")?u(b,"action"):null:(a=v(a),a=w(a),a=t(a,"action")?u(a,"action"):null);return a}function x(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return u(a,b)}function y(a){var b=v(a);b=w(b);return u(b,"viewer")}function v(a){return a.nodeType?x((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function w(a){a=v(a);return a.isSingleDoc()?a.win:a}
function u(a,b){t(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});var d=c;a=d[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function t(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function A(a,b){try{return JSON.parse(a)}catch(c){return b&&b(c),null}};var B=["ACTIVE_ACTION_STATUS","FAILED_ACTION_STATUS","COMPLETED_ACTION_STATUS"];function C(a){var b=a.getElementById("amp-viewer-assistance");if(this.l=!!b)this.o=a,this.j=b,this.A=A(this.j.textContent,function(a){throw m().createError('Failed to parse "amp-viewer-assistance" JSON: '+a);}),this.h=y(a),this.m=r(this.j),this.B=x(a.win,"vsync")}
C.prototype.w=function(a){var b=this,c=a,d=c.method;c=c.args;"updateActionState"==d?a.satisfiesTrust(1)&&D(c).then(function(a){return b.h.sendMessageAwaitResponse(d,a)}).catch(function(a){m().error("amp-viewer-assistance",a.toString())}):"signIn"==d&&a.satisfiesTrust(100)&&E(this);return null};
function F(a){return a.l?a.h.isTrustedViewer().then(function(b){if(!b&&!p(a.o.win,"amp-viewer-assistance-untrusted"))return a.l=!1,m().error("amp-viewer-assistance","amp-viewer-assistance is currently only supported on trusted viewers."),a;a.m.installActionHandler(a.j,a.w.bind(a));a.getIdTokenPromise();a.h.sendMessage("viewerAssistanceConfig",n({config:a.A}));return a}):(m().error("amp-viewer-assistance","Could not find #amp-viewer-assistance element."),a)}
C.prototype.getIdTokenPromise=function(){var a=this;return this.h.sendMessageAwaitResponse("getAccessTokenPassive",n({providers:["actions-on-google-gsi"]})).then(function(b){G(a,!!b);return b}).catch(function(){G(a,!1)})};function E(a){a.h.sendMessageAwaitResponse("requestSignIn",n({providers:["actions-on-google-gsi"]})).then(function(b){m().info("amp-viewer-assistance","Token: "+b);b?(G(a,!0),a.m.trigger(a.j,"signedIn",null,100)):G(a,!1)})}
function D(a){if(!a)return Promise.reject('"updateActionState" was called with no arguments!"');var b=a.update,c=a.error;if(c&&b)return Promise.reject('"updateActionState" must have only one of the parameters "error" and "update".');if(c)return c&&"function"===typeof c.text?c.text().then(function(a){return n({update:{actionStatus:"FAILED_ACTION_STATUS",result:{code:c.status,message:a}}})}):Promise.reject('"updateActionState" action "error" parameter must contain a valid "response" object.');if(b){var d=
b&&b.actionStatus;return d&&B.includes(d)?Promise.resolve(a):Promise.reject('"updateActionState" action "update" parameter must contain a valid "actionStatus" field.')}return Promise.reject('"updateActionState" action must have an "update" or "error" parameter.')}function G(a,b){var c="amp-viewer-assistance-identity-available";a.B.mutate(function(){var d=a.o.getRootNode();(d.documentElement||d.body||d).classList.toggle(c,b)})}(function(a){a.registerServiceForDoc("amp-viewer-assistance",function(a){return F(new C(a))})})(self.AMP);
})});

//# sourceMappingURL=amp-viewer-assistance-0.1.js.map
