(function(){var f,k=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a}(this);function m(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var n=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function p(a){var b=Object.create(null);if(!a)return b;for(var c;c=n.exec(a);){var d=m(c[1],c[1]),e=c[2]?m(c[2].replace(/\+/g," "),c[2]):"";b[d]=e}return b};var q="";
function r(){var a,b=a||self;if(b.__AMP_MODE)var c=b.__AMP_MODE;else{c=b;var d=self.AMP_CONFIG||{},e=!!d.test||!(!c.__AMP_TEST&&!c.__karma__),h=c.__karma__&&c.__karma__.config.amp.testOnIe,l=!!d.localDev||e,g=p(c.location.originalHash||c.location.hash);d=d.spt;var D=p(c.location.search);q||(q=l?"1910151804560":c.AMP_CONFIG&&c.AMP_CONFIG.v?c.AMP_CONFIG.v:"011910151804560");c={localDev:l,development:!!(0<=["1","actions","amp","amp4ads","amp4email"].indexOf(g.development)||c.AMP_DEV_MODE),examiner:"2"==g.development,
filter:g.filter,geoOverride:g["amp-geo"],userLocationOverride:g["amp-user-location"],minified:!0,lite:void 0!=D.amp_lite,test:e,testIe:h,log:g.log,version:"1910151804560",rtvVersion:q,singlePassType:d};c=b.__AMP_MODE=c}return c};self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var t=self.__AMP_LOG;/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
var u=/(\0)|^(-)$|([\x01-\x1f\x7f]|^-?[0-9])|([\x80-\uffff0-9a-zA-Z_-]+)|[^]/g;function v(a,b,c,d,e){return e?e:b?"\ufffd":d?a.slice(0,-1)+"\\"+a.slice(-1).charCodeAt(0).toString(16)+" ":"\\"+a};function w(){var a=100;this.L=a;this.B=this.G=0;this.o=Object.create(null)}w.prototype.has=function(a){return!!this.o[a]};w.prototype.get=function(a){var b=this.o[a];if(b)return b.access=++this.B,b.payload};
w.prototype.put=function(a,b){this.has(a)||this.G++;this.o[a]={payload:b,access:this.B};if(!(this.G<=this.L)){if(t.dev)a=t.dev;else throw Error("failed to call initLogConstructor");a.warn("lru-cache","Trimming LRU cache");a=this.o;var c=this.B+1,d;for(d in a){var e=a[d].access;if(e<c){c=e;var h=d}}void 0!==h&&(delete a[h],this.G--)}};(function(a){return a||{}})({c:!0,v:!0,a:!0,ad:!0,action:!0});var x,y;
function z(a){var b;x||(x=self.document.createElement("a"),y=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new w));var c=b?null:y,d=x;if(c&&c.has(a))a=c.get(a);else{d.href=a;d.protocol||(d.href=d.href);var e={href:d.href,protocol:d.protocol,host:d.host,hostname:d.hostname,port:"0"==d.port?"":d.port,pathname:d.pathname,search:d.search,hash:d.hash,origin:null};"/"!==e.pathname[0]&&(e.pathname="/"+e.pathname);if("http:"==e.protocol&&80==e.port||"https:"==e.protocol&&443==e.port)e.port="",e.host=e.hostname;
e.origin=d.origin&&"null"!=d.origin?d.origin:"data:"!=e.protocol&&e.host?e.protocol+"//"+e.host:e.href;d=r().test&&Object.freeze?Object.freeze(e):e;c&&c.put(a,d);a=d}return a};function A(a){a||(a={debug:!1,windowContext:window});this.m={};this.l={};this.I=a.debug;this.w=this.M=this.N=!1;this.A=this.D=this.F=this.j=this.C=null;this.h=a.windowContext||window}f=A.prototype;
f.listen=function(a){var b=this;return(new Promise(function(c,d){b.w?d(Error("Already connected.")):b.N?d(Error("Already listening for connections.")):Array.isArray(a)?(b.F=b.P.bind(b,a,c,d),b.h.addEventListener("message",b.F)):d(Error("allowedOrigins should be a string array of allowed origins to accept messages from. Got:",a))})).then(function(){b.send(A.Topics.CONNECT_HANDSHAKE,null);b.w=!0})};
f.P=function(a,b,c,d){var e=d.data,h=d,l=h.ports;a:{h=z(h.origin).origin;for(var g=0;g<a.length;g++)if(z(a[g]).origin===h){a=!0;break a}a=!1}a&&e&&e.topic===A.Topics.CONNECT_HANDSHAKE&&(this.h.removeEventListener("message",this.F),this.j=l[0],this.A=this.J.bind(this),this.j.addEventListener("message",this.A,!1),this.j.start(),b())};
f.connect=function(a,b){var c=this;return new Promise(function(d,e){a||e(Error("Provide a valid Window context to connect to."));b||e(Error("Provide an expected origin for the remote Window or provide the wildcard *."));c.w?e(Error("Already connected.")):c.M?e(Error("Already connecting.")):(c.C=new MessageChannel,c.j=c.C.port1,c.D=c.O.bind(c,c.j,b,d),c.j.addEventListener("message",c.D),c.j.start(),a.postMessage({topic:A.Topics.CONNECT_HANDSHAKE},"*"===b?"*":z(b).origin,[c.C.port2]))})};
f.O=function(a,b,c){this.w=!0;a.removeEventListener("message",this.D);this.A=this.J.bind(this);a.addEventListener("message",this.A,!1);c()};f.J=function(a){a=a.data;if(this.m[a.id]&&a.isReply){var b=this.m[a.id];delete this.m[a.id];var c=b.promiseResolver;b.message=a.data;c([a.data,this.K.bind(this,a.id,b.topic)])}else{var d=this.l[a.topic];if(d)for(var e=0;e<d.length;e++)(0,d[e])(a.data,this.K.bind(this,a.id,a.topic))}};f.on=function(a,b){this.l[a]?this.l[a].push(b):this.l[a]=[b]};
f.off=function(a,b){if(b){var c=this.l[a].indexOf(b);-1!==c&&this.l[a].splice(c,1)}else this.l[a]&&delete this.l[a]};f.K=function(a,b,c){var d=this,e={id:a,topic:b,data:c,isReply:!0};this.j.postMessage(e);return new Promise(function(a){d.m[e.id]={message:c,topic:b,promiseResolver:a}})};f.send=function(a,b){var c=this,d={id:crypto.getRandomValues(new Uint8Array(10)).join(""),topic:a,data:b};this.j.postMessage(d);return new Promise(function(e){c.m[d.id]={message:b,topic:a,promiseResolver:e}})};
k.Object.defineProperties(A,{Topics:{configurable:!0,enumerable:!0,get:function(){return{CONNECT_HANDSHAKE:"topic-connect-handshake",NOTIFICATION_PERMISSION_STATE:"topic-notification-permission-state",SERVICE_WORKER_STATE:"topic-service-worker-state",SERVICE_WORKER_REGISTRATION:"topic-service-worker-registration",SERVICE_WORKER_QUERY:"topic-service-worker-query",STORAGE_GET:"topic-storage-get"}}}});function B(){var a={debug:!1};this.I=a&&a.debug;this.h=a.windowContext||window;this.H=new A({debug:this.I,windowContext:this.h})}f=B.prototype;f.isCurrentDialogPopup=function(){return!!this.h.opener&&this.h.opener!==this.h};f.requestNotificationPermission=function(){var a=this;return new Promise(function(b,c){try{a.h.Notification.requestPermission(function(a){return b(a)})}catch(d){c(d)}})};
f.run=function(){C(this);E(this);for(var a=this.h.document.querySelectorAll("[permission]"),b=0;b<a.length;b++)F(a[b],!1);(a=this.h.document.querySelector("[permission="+String(this.h.Notification.permission).replace(u,v)+"]"))&&F(a,!0);a=this.h.document.querySelector("#preload");b=this.h.document.querySelector("#postload");a&&b&&(F(a,!1),F(b,!0));"denied"!==this.h.Notification.permission?G(this):H(this)};
function C(a){var b=a.h.document.querySelector("#close");b&&b.addEventListener("click",function(){a.closeDialog()})}f.closeDialog=function(){if(this.isCurrentDialogPopup())this.h.close();else{var a=this.h.fakeLocation||this.h.location,b=p(a.search);if(!b["return"])throw Error("Missing required parameter.");var c=m(b["return"],void 0);this.redirectToUrl(c)}};
function H(a){navigator.permissions.query({name:"notifications"}).then(function(b){b.onchange=function(){E(a);switch(a.h.Notification.permission){case "default":case "granted":G(a)}}})}function E(a){a.h.localStorage.setItem("amp-web-push-notification-permission",a.h.Notification.permission)}function F(a,b){if(a){var c="invisible";b?a.classList.remove(c):a.classList.add(c)}}
function G(a){a.requestNotificationPermission().then(function(b){E(a);if(a.isCurrentDialogPopup())return a.H.connect(opener,"*"),a.H.send(A.Topics.NOTIFICATION_PERMISSION_STATE,b).then(function(b){(b=b[0])&&b.closeFrame&&a.closeDialog()});a.closeDialog()})}f.redirectToUrl=function(a){var b=z(a);!b||"http:"!==b.protocol&&"https:"!==b.protocol||(this.h.location.href=a)};r().test||(window._ampWebPushPermissionDialog=new B,window._ampWebPushPermissionDialog.run());})();

//# sourceMappingURL=amp-web-push-permission-dialog.js.map
