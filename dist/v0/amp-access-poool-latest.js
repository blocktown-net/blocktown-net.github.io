(self.AMP=self.AMP||[]).push({n:"amp-access-poool",v:"1910151804560",f:(function(AMP,_){
function m(){var a,b;this.promise=new Promise(function(c,d){a=c;b=d});this.resolve=a;this.reject=b};function n(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var r=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function t(a){var b=Object.create(null);if(!a)return b;for(var c;c=r.exec(a);){var d=n(c[1],c[1]),e=c[2]?n(c[2].replace(/\+/g," "),c[2]):"";b[d]=e}return b};var u="";
function v(){var a,b=a||self;if(b.__AMP_MODE)var c=b.__AMP_MODE;else{c=b;var d=self.AMP_CONFIG||{},e=!!d.test||!(!c.__AMP_TEST&&!c.__karma__),f=c.__karma__&&c.__karma__.config.amp.testOnIe,g=!!d.localDev||e,h=t(c.location.originalHash||c.location.hash);d=d.spt;var k=t(c.location.search);u||(u=g?"1910151804560":c.AMP_CONFIG&&c.AMP_CONFIG.v?c.AMP_CONFIG.v:"011910151804560");c={localDev:g,development:!!(0<=["1","actions","amp","amp4ads","amp4email"].indexOf(h.development)||c.AMP_DEV_MODE),examiner:"2"==h.development,
filter:h.filter,geoOverride:h["amp-geo"],userLocationOverride:h["amp-user-location"],minified:!0,lite:void 0!=k.amp_lite,test:e,testIe:f,log:h.log,version:"1910151804560",rtvVersion:u,singlePassType:d};c=b.__AMP_MODE=c}return c};self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var w=self.__AMP_LOG;function x(){if(w.dev)return w.dev;throw Error("failed to call initLogConstructor");}function y(a,b,c,d,e,f){if(!w.user)throw Error("failed to call initLogConstructor");return w.user.assert(a,b,c,d,e,f,void 0,void 0,void 0,void 0,void 0)};function z(a){return a||{}};function A(){var a=100;this.D=a;this.o=this.w=0;this.m=Object.create(null)}A.prototype.has=function(a){return!!this.m[a]};A.prototype.get=function(a){var b=this.m[a];if(b)return b.access=++this.o,b.payload};A.prototype.put=function(a,b){this.has(a)||this.w++;this.m[a]={payload:b,access:this.o};if(!(this.w<=this.D)){x().warn("lru-cache","Trimming LRU cache");a=this.m;var c=this.o+1,d;for(d in a){var e=a[d].access;if(e<c){c=e;var f=d}}void 0!==f&&(delete a[f],this.w--)}};z({c:!0,v:!0,a:!0,ad:!0,action:!0});var B,C;
function D(a){var b;B||(B=self.document.createElement("a"),C=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new A));var c=b?null:C,d=B;if(c&&c.has(a))a=c.get(a);else{d.href=a;d.protocol||(d.href=d.href);var e={href:d.href,protocol:d.protocol,host:d.host,hostname:d.hostname,port:"0"==d.port?"":d.port,pathname:d.pathname,search:d.search,hash:d.hash,origin:null};"/"!==e.pathname[0]&&(e.pathname="/"+e.pathname);if("http:"==e.protocol&&80==e.port||"https:"==e.protocol&&443==e.port)e.port="",e.host=e.hostname;
e.origin=d.origin&&"null"!=d.origin?d.origin:"data:"!=e.protocol&&e.host?e.protocol+"//"+e.host:e.href;d=v().test&&Object.freeze?Object.freeze(e):e;c&&c.put(a,d);a=d}return a}function E(a,b,c){if(!b)return a;var d=a.split("#",2),e=d[0].split("?",2),f=e[0]+(e[1]?c?"?"+b+"&"+e[1]:"?"+e[1]+"&"+b:"?"+b);return f+=d[1]?"#"+d[1]:""}function F(a,b){b=encodeURIComponent("iid")+"="+encodeURIComponent(b);return E(a,b,void 0)}
function G(a,b){var c=[],d;for(d in b){var e=b[d];if(null!=e)if(Array.isArray(e))for(var f=0;f<e.length;f++){var g=e[f];c.push(encodeURIComponent(d)+"="+encodeURIComponent(g))}else c.push(encodeURIComponent(d)+"="+encodeURIComponent(e))}b=c.join("&");return E(a,b)};function H(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return I(a,b)}function J(a){return a.nodeType?H((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function K(a){a=J(a);return a.isSingleDoc()?a.win:a}function I(a,b){var c=L(a);a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function M(a){var b=L(a).access;if(b){if(b.promise)return b.promise;I(a,"access");return b.promise=Promise.resolve(b.obj)}return null}
function L(a){var b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function N(){var a=new m,b=a,c=b.promise,d=b.resolve;b=b.reject;c.catch(function(){});return{obj:null,promise:c,resolve:d,reject:b,context:null,ctor:null}};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function O(a){return Q(a).then(function(a){return y(a,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.","access","amp-access","amp-access","amp-access")})}
function Q(a){var b=M(K(a));if(b)return b;var c=J(a);return c.waitForBodyOpen().then(function(){var a=c.win;var b=c.win.document.head;if(b){var f={};b=b.querySelectorAll("script[custom-element],script[custom-template]");for(var g=0;g<b.length;g++){var h=b[g];h=h.getAttribute("custom-element")||h.getAttribute("custom-template");f[h]=!0}f=Object.keys(f)}else f=[];a=f.includes("amp-access")?H(a,"extensions").waitForExtension(a,"amp-access"):Promise.resolve();return a}).then(function(){var b=c.win;if(b.__AMP_EXTENDED_ELEMENTS&&
b.__AMP_EXTENDED_ELEMENTS["amp-access"]){b=K(a);var e=M(b);e?b=e:(b=L(b),b.access=N(),b=b.access.promise)}else b=null;return b})};function R(a,b){try{return JSON.parse(a)}catch(c){return b&&b(c),null}};function aa(a){if(!S(a))return null;var b=a.indexOf("{");try{return JSON.parse(a.substr(b))}catch(c){return x().error("MESSAGING","Failed to parse message: "+a,c),null}}function S(a){return"string"==typeof a&&0==a.indexOf("amp-")&&-1!=a.indexOf("{")};var T,U="Webkit webkit Moz moz ms O o".split(" ");function V(a,b,c){var d;var e=a.style;if(2>b.length||0!=b.lastIndexOf("--",0)){T||(T=Object.create(null));var f=T[b];if(!f){f=b;if(void 0===e[b]){var g=b.charAt(0).toUpperCase()+b.slice(1);b:{for(var h=0;h<U.length;h++){var k=U[h]+g;if(void 0!==e[k]){g=k;break b}}g=""}void 0!==e[g]&&(f=g)}T[b]=f}b=f}b&&(a.style[b]=d?c+d:c)};function W(a,b,c){var d=a.listeningFors;!d&&c&&(d=a.listeningFors=Object.create(null));a=d||null;if(!a)return a;var e=a[b];!e&&c&&(e=a[b]=[]);return e||null}function ba(a,b){var c=void 0,d=c?b.getAttribute("data-amp-3p-sentinel"):"amp";a=W(a,d,!0);for(d=0;d<a.length;d++){var e=a[d];if(e.frame===b){var f=e;break}}f||(f={frame:b,events:Object.create(null)},a.push(f));return f.events}
function ca(a){for(var b=z({sentinel:"unlisten"}),c=a.length-1;0<=c;c--){var d=a[c];if(!d.frame.contentWindow){a.splice(c,1);var e=d.events,f;for(f in e)e[f].splice(0,Infinity).forEach(function(a){a(b)})}}}
function da(a){if(!a.listeningFors){var b=function(b){if(b.data){var c=ea(b.data);if(c&&c.sentinel){var e=b.source;var f=W(a,c.sentinel);if(f){for(var g,h=0;h<f.length;h++){var k=f[h],p=k.frame.contentWindow;if(p){var l;if(!(l=e==p))b:{for(l=e;l&&l!=l.parent;l=l.parent)if(l==p){l=!0;break b}l=!1}if(l){g=k;break}}else setTimeout(ca,0,f)}e=g?g.events:null}else e=f;var P=e;if(P){var q=P[c.type];if(q)for(q=q.slice(),e=0;e<q.length;e++)(0,q[e])(c,b.source,b.origin,b)}}}};a.addEventListener("message",b)}}
function X(a,b,c){function d(b,d,g,k){if("amp"==b.sentinel){if(d!=a.contentWindow)return;var l="null"==g&&f;if(h!=g&&!l)return}if(e||d==a.contentWindow)"unlisten"==b.sentinel?p():c(b,d,g,k)}var e,f,g=a.ownerDocument.defaultView;da(g);g=ba(g,a);var h=D(a.src).origin,k=g[b]||(g[b]=[]);k.push(d);var p=function(){if(d){var a=k.indexOf(d);-1<a&&k.splice(a,1);c=k=d=null}}}
function ea(a){"string"==typeof a&&(a="{"==a.charAt(0)?R(a,function(a){x().warn("IFRAME-HELPER","Postmessage could not be parsed. Is it in a valid JSON format?",a)})||null:S(a)?aa(a):null);return a};var Y={authorization:"https://api.poool.fr/api/v2/amp/access?rid=READER_ID",iframe:"https://assets.poool.fr/amp.html?rid=READER_ID&c=CANONICAL_URL&o=AMPDOC_URL&r=DOCUMENT_REFERRER"};
function Z(a,b){this.ampdoc=a.ampdoc;this.l=b;this.B=Y.authorization;this.F=Y.iframe;this.K=H(this.ampdoc.win,"timer");this.L=H(this.ampdoc.win,"xhr");var c=J(this.ampdoc);c=K(c);this.G=I(c,"navigation");this.j=this.l.getAdapterConfig();this.C=this.j.bundleID||"";this.M="";this.A=this.j.itemID||"";this.h=document.createElement("iframe");this.h.setAttribute("id","poool-iframe");this.h.setAttribute("scrolling","no");this.h.setAttribute("frameborder","0");V(this.h,"width","100%");if("unlock"==this.j.forceWidget){var d=
this.h;c={height:"250px",position:"fixed",bottom:"0"};for(var e in c)V(d,e,c[e])}else for(d in e=this.h,c={height:"500px",transform:"translateY(-70px)"},c)V(e,d,c[d]);y(this.C,"BundleID is incorrect or not provided.");y(this.A,"ItemID is not provided.")}Z.prototype.authorize=function(){var a=this;return fa(this).then(function(a){return{access:a.access}},function(b){if(!b||!b.response)throw b;if(402!==b.response.status)throw b;ha(a);return{access:!1}})};
function fa(a){var b=F(a.B,a.A),c=a.l.buildUrl(b,!1);return c.then(function(b){return a.l.getLoginUrl(b)}).then(function(b){x().info("amp-access-poool","Authorization URL: ",b);return a.K.timeoutPromise(3E3,a.L.fetchJson(b)).then(function(a){return a.json()})})}
function ha(a){var b=document.getElementById("poool");a.l.buildUrl(G(a.F,z({bi:a.j.bundleID,iid:a.j.itemID,ce:a.j.cookiesEnabled,d:"undefined"!==typeof a.j.debug&&null!==a.j.debug?a.j.debug:v().development||v().localDev,fw:a.j.forceWidget,cs:a.j.customSegment})),!1).then(function(c){a.h.src=c;X(a.h,"release",a.I.bind(a));X(a.h,"resize",a.J.bind(a));X(a.h,"click",a.H.bind(a));b.appendChild(a.h)})}
Z.prototype.I=function(){var a=document.querySelector("[poool-access-preview]");a.setAttribute("amp-access-hide","");var b=document.querySelector("[poool-access-content]");b.removeAttribute("amp-access-hide");for(var c=this.h,d=["transform"],e=0;e<d.length;e++)V(c,d[e],null)};Z.prototype.J=function(a){V(this.h,"height",a.height)};Z.prototype.H=function(a){a.url&&this.G.navigateTo(this.ampdoc.win,a.url)};Z.prototype.pingback=function(){return Promise.resolve()};(function(a){a.registerServiceForDoc("poool",function(a){a=a.getHeadNode();return O(a).then(function(a){var b=a.getVendorSource("poool"),c=new Z(a,b),f=b.getAdapter();f.registerVendor(c);return c})})})(self.AMP);
})});

//# sourceMappingURL=amp-access-poool-0.1.js.map
