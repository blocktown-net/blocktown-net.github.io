(self.AMP=self.AMP||[]).push({n:"amp-vk",v:"1910151804560",f:(function(AMP,_){
var g,h="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},k;if("function"==typeof Object.setPrototypeOf)k=Object.setPrototypeOf;else{var l;a:{var m={a:!0},n={};try{n.__proto__=m;l=n.a;break a}catch(a){}l=!1}k=l?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var p=k;self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var q=self.__AMP_LOG;function r(){if(!q.user)throw Error("failed to call initLogConstructor");return q.user}function t(a,b,c){return r().assert(a,b,c,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)};function v(a){return a||{}};v({c:!0,v:!0,a:!0,ad:!0,action:!0});function w(a,b){var c;if(!b)return a;var d=a.split("#",2),e=d[0].split("?",2),f=e[0]+(e[1]?c?"?"+b+"&"+e[1]:"?"+e[1]+"&"+b:"?"+b);return f+=d[1]?"#"+d[1]:""}function x(a){var b=[],c;for(c in a){var d=a[c];if(null!=d)if(Array.isArray(d))for(var e=0;e<d.length;e++){var f=d[e];b.push(encodeURIComponent(c)+"="+encodeURIComponent(f))}else e=d,b.push(encodeURIComponent(c)+"="+encodeURIComponent(e))}return b.join("&")};function y(a){var b=z(a);b=z(b);b=b.isSingleDoc()?b.win:b;return A(b,"viewer")}function z(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView;b=b.__AMP_TOP||(b.__AMP_TOP=b);a=A(b,"ampdoc").getAmpDoc(a)}return a}function A(a,b){var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});var d=c;a=d[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
var B;function C(a,b){var c=void 0,d=a,e=b;var f=function(a){try{return e(a)}catch(D){throw self.__AMP_REPORT_ERROR(D),D;}};var E=F(),u=!1;c&&(u=c.capture);d.addEventListener("message",f,E?c:u);return function(){d&&d.removeEventListener("message",f,E?c:u);f=d=e=null}}function F(){if(void 0!==B)return B;B=!1;try{var a={get capture(){B=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return B};function G(a,b){return C(a,b)};var H={POST:"post",POLL:"poll"};function I(a){a=AMP.BaseElement.call(this,a)||this;a.j=null;a.C=0;a.l=null;a.h=null;a.w=null;a.B=null;a.o=null;a.m=null;a.A=null;return a}var J=AMP.BaseElement;I.prototype=h(J.prototype);I.prototype.constructor=I;if(p)p(I,J);else for(var K in J)if("prototype"!=K)if(Object.defineProperties){var L=Object.getOwnPropertyDescriptor(J,K);L&&Object.defineProperty(I,K,L)}else I[K]=J[K];I.F=J.prototype;g=I.prototype;
g.preconnectCallback=function(a){this.preconnect.url("https://vk.com",a)};function M(a){var b=Date.now().toString(16),c;"post"===a.h?c=N(a):"poll"===a.h&&(c=O(a));return c.then(function(a){return w(a,b)})}
function N(a){return y(a.element).getReferrerUrl().then(function(b){var c=a.element.offsetWidth,d=a.getAmpDoc().getUrl(),e="https://vk.com/widget_post.php",f=v({app:"0",width:"100%",_ver:"1",owner_id:a.w,post_id:a.B,hash:a.o,amp:"1",startWidth:c,url:d,referrer:b,title:"AMP Post"});return w(e,x(f))})}
function O(a){return y(a.element).getReferrerUrl().then(function(b){var c=a.getAmpDoc().getUrl();b=v({app:a.m,width:"100%",_ver:"1",poll_id:a.A,amp:"1",url:c,title:"AMP Poll",description:"",referrer:b});return w("https://vk.com/al_widget_poll.php",x(b))})}
g.buildCallback=function(){this.h=t(this.element.getAttribute("data-embedtype"),"The data-embedtype attribute is required for <amp-vk> %s",this.element);r().assertEnumValue(H,this.h,"data-embedtype");"post"===this.h?(this.w=t(this.element.getAttribute("data-owner-id"),"The data-owner-id attribute is required for <amp-vk> Post %s",this.element),this.B=t(this.element.getAttribute("data-post-id"),"The data-post-id attribute is required for <amp-vk> Post %s",this.element),this.o=t(this.element.getAttribute("data-hash"),
"The data-hash attribute is required for <amp-vk> Post %s",this.element)):"poll"===this.h&&(this.m=t(this.element.getAttribute("data-api-id"),"The data-api-id attribute is required for <amp-vk> Poll %s",this.element),this.A=t(this.element.getAttribute("data-poll-id"),"The data-poll-id attribute is required for <amp-vk> Poll %s",this.element))};
g.layoutCallback=function(){var a=this,b=this.element.ownerDocument.createElement("iframe");this.j=b;this.l=G(this.win,this.D.bind(this));return M(this).then(function(c){b.src=c;b.setAttribute("name","fXD");b.setAttribute("scrolling","no");b.setAttribute("frameborder","0");b.setAttribute("allowfullscreen","true");a.applyFillContent(b);a.element.appendChild(b);return a.loadPromise(b)})};
g.D=function(a){if("https://vk.com"===a.origin&&a.source===this.j.contentWindow){var b=a.data;if(b){var c=/\["resize",\[(\d+)\]]/;if((a=c.exec(b))&&a[1]){var d=parseInt(a[1],10);this.C!==d&&(this.C=d,this.changeHeight(d))}}}};g.isLayoutSupported=function(a){return"responsive"===a||"flex-item"===a||"fixed"===a};g.unlayoutOnPause=function(){return!0};g.unlayoutCallback=function(){if(this.j){var a=this.j;a.parentElement&&a.parentElement.removeChild(a);this.j=null}this.l&&this.l();return!0};
(function(a){a.registerElement("amp-vk",I)})(self.AMP);
})});

//# sourceMappingURL=amp-vk-0.1.js.map
