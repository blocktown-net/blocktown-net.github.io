(self.AMP=self.AMP||[]).push({n:"amp-user-location",v:"1910151804560",f:(function(AMP,_){
var k="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},l;if("function"==typeof Object.setPrototypeOf)l=Object.setPrototypeOf;else{var m;a:{var aa={a:!0},n={};try{n.__proto__=aa;m=n.a;break a}catch(a){}m=!1}l=m?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var p=l;function ba(){var a,b;this.promise=new Promise(function(c,d){a=c;b=d});this.resolve=a;this.reject=b};function q(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var ca=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function r(a){var b=Object.create(null);if(!a)return b;for(var c;c=ca.exec(a);){var d=q(c[1],c[1]),e=c[2]?q(c[2].replace(/\+/g," "),c[2]):"";b[d]=e}return b};var t="";
function u(a){var b=a||self;if(b.__AMP_MODE)var c=b.__AMP_MODE;else{c=b;var d=self.AMP_CONFIG||{},e=!!d.test||!(!c.__AMP_TEST&&!c.__karma__),f=c.__karma__&&c.__karma__.config.amp.testOnIe,g=!!d.localDev||e,h=r(c.location.originalHash||c.location.hash);d=d.spt;var da=r(c.location.search);t||(t=g?"1910151804560":c.AMP_CONFIG&&c.AMP_CONFIG.v?c.AMP_CONFIG.v:"011910151804560");c={localDev:g,development:!!(0<=["1","actions","amp","amp4ads","amp4email"].indexOf(h.development)||c.AMP_DEV_MODE),examiner:"2"==h.development,
filter:h.filter,geoOverride:h["amp-geo"],userLocationOverride:h["amp-user-location"],minified:!0,lite:void 0!=da.amp_lite,test:e,testIe:f,log:h.log,version:"1910151804560",rtvVersion:t,singlePassType:d};c=b.__AMP_MODE=c}return c};var ea=Object.prototype.toString;self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var v=self.__AMP_LOG;function w(){if(!v.user)throw Error("failed to call initLogConstructor");return v.user}function x(){if(v.dev)return v.dev;throw Error("failed to call initLogConstructor");}function y(a,b,c,d,e){w().assert(a,b,c,d,e,void 0,void 0,void 0,void 0,void 0,void 0)};function z(a){return a||{}};function A(){var a=100;this.K=a;this.A=this.F=0;this.o=Object.create(null)}A.prototype.has=function(a){return!!this.o[a]};A.prototype.get=function(a){var b=this.o[a];if(b)return b.access=++this.A,b.payload};A.prototype.put=function(a,b){this.has(a)||this.F++;this.o[a]={payload:b,access:this.A};if(!(this.F<=this.K)){x().warn("lru-cache","Trimming LRU cache");a=this.o;var c=this.A+1,d;for(d in a){var e=a[d].access;if(e<c){c=e;var f=d}}void 0!==f&&(delete a[f],this.F--)}};z({c:!0,v:!0,a:!0,ad:!0,action:!0});var B,C;
function fa(a,b){var c=void 0===c?"source":c;y(null!=a,"%s %s must be available",b,c);var d=a;a=d;if("string"==typeof a){B||(B=self.document.createElement("a"),C=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new A));var e=C,f=B;if(e&&e.has(a))a=e.get(a);else{f.href=a;f.protocol||(f.href=f.href);var g={href:f.href,protocol:f.protocol,host:f.host,hostname:f.hostname,port:"0"==f.port?"":f.port,pathname:f.pathname,search:f.search,hash:f.hash,origin:null};"/"!==g.pathname[0]&&(g.pathname="/"+g.pathname);
if("http:"==g.protocol&&80==g.port||"https:"==g.protocol&&443==g.port)g.port="",g.host=g.hostname;g.origin=f.origin&&"null"!=f.origin?f.origin:"data:"!=g.protocol&&g.host?g.protocol+"//"+g.host:g.href;f=u().test&&Object.freeze?Object.freeze(g):g;e&&e.put(a,f);a=f}}(e="https:"==a.protocol||"localhost"==a.hostname||"127.0.0.1"==a.hostname)||(a=a.hostname,e=a.length-10,e=0<=e&&a.indexOf(".localhost",e)==e);y(e||/^(\/\/)/.test(d),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',
b,c,d)};function D(a,b){if(a.__AMP__EXPERIMENT_TOGGLES)var c=a.__AMP__EXPERIMENT_TOGGLES;else{a.__AMP__EXPERIMENT_TOGGLES=Object.create(null);c=a.__AMP__EXPERIMENT_TOGGLES;if(a.AMP_CONFIG)for(var d in a.AMP_CONFIG){var e=a.AMP_CONFIG[d];"number"===typeof e&&0<=e&&1>=e&&(c[d]=Math.random()<e)}if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-doc-opt-in"])&&0<a.AMP_CONFIG["allow-doc-opt-in"].length&&(d=a.AMP_CONFIG["allow-doc-opt-in"],e=a.document.head.querySelector('meta[name="amp-experiments-opt-in"]'))){e=
e.getAttribute("content").split(",");for(var f=0;f<e.length;f++)-1!=d.indexOf(e[f])&&(c[e[f]]=!0)}Object.assign(c,ha(a));if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-url-opt-in"])&&0<a.AMP_CONFIG["allow-url-opt-in"].length)for(d=a.AMP_CONFIG["allow-url-opt-in"],a=r(a.location.originalHash||a.location.hash),e=0;e<d.length;e++)f=a["e-"+d[e]],"1"==f&&(c[d[e]]=!0),"0"==f&&(c[d[e]]=!1)}var g=c;return!!g[b]}
function ha(a){var b="";try{"localStorage"in a&&(b=a.localStorage.getItem("amp-experiment-toggles"))}catch(e){x().warn("EXPERIMENTS","Failed to retrieve experiments from localStorage.")}var c=b?b.split(/\s*,\s*/g):[];a=Object.create(null);for(var d=0;d<c.length;d++)0!=c[d].length&&("-"==c[d][0]?a[c[d].substr(1)]=!1:a[c[d]]=!0);return a};function E(a,b){var c=a.ownerDocument.defaultView,d=c.__AMP_TOP||(c.__AMP_TOP=c),e=c!=d,f=D(d,"ampdoc-fie");e&&!f?b=F(c,b)?G(c,b):null:(a=H(a),a=I(a),b=F(a,b)?G(a,b):null);return b}function J(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return G(a,b)}function H(a){return a.nodeType?J((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function I(a){a=H(a);return a.isSingleDoc()?a.win:a}
function G(a,b){F(a,b);var c=K(a);a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function L(a){var b=K(a)["user-location"];if(b){if(b.promise)return b.promise;G(a,"user-location");return b.promise=Promise.resolve(b.obj)}return null}function K(a){var b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function F(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function ia(a){return"SCRIPT"==a.tagName&&a.hasAttribute("type")&&"APPLICATION/JSON"==a.getAttribute("type").toUpperCase()};function ja(a){var b=L(I(a));if(b)return b;var c=H(a);return c.waitForBodyOpen().then(function(){var a=c.win;var b=c.win.document.head;if(b){var f={};b=b.querySelectorAll("script[custom-element],script[custom-template]");for(var g=0;g<b.length;g++){var h=b[g];h=h.getAttribute("custom-element")||h.getAttribute("custom-template");f[h]=!0}f=Object.keys(f)}else f=[];a=f.includes("amp-user-location")?J(a,"extensions").waitForExtension(a,"amp-user-location"):Promise.resolve();return a}).then(function(){return L(I(a))})}
;function ka(a,b){try{return JSON.parse(a)}catch(c){return b&&b(c),null}};function la(a,b){var c=".",d=2,e;c=void 0===c?".":c;d=void 0===d?0:d;var f=void 0===f?!1:f;fa(b.getAttribute("src"),b);var g=J(a.win,"batched-xhr");return ma(b,d,f).then(function(a){void 0!==e&&(a.fetchOpt.method="POST",a.fetchOpt.headers={"Content-Type":"application/x-www-form-urlencoded"},a.fetchOpt.body={ampViewerAuthToken:e});return g.fetchJson(a.xhrUrl,a.fetchOpt)}).then(function(a){return a.json()}).then(function(a){if(null==a)throw Error("Response is undefined.");var b=c||".";if("."==b)b=a;
else{b=b.split(".");for(var d=0;d<b.length;d++){var e=b[d];if(e&&a&&void 0!==a[e]&&(null==a||"object"!=typeof a?0:Object.prototype.hasOwnProperty.call(a,e)))a=a[e];else{a=void 0;break}}b=a}return b})}
function ma(a,b,c){var d=a.getAttribute("src"),e=E(a,"url-replace");return(1<=b?e.expandUrlAsync(d):Promise.resolve(d)).then(function(d){if(1==b){var f=e.collectUnwhitelistedVarsSync(a);if(0<f.length)throw w().createError('URL variable substitutions in CORS fetches from dynamic URLs (e.g. via amp-bind) require opt-in. Please add data-amp-replace="'+(f.join(" ")+'" to the <')+(a.tagName+"> element. See https://bit.ly/amp-var-subs."));}var h={};a.hasAttribute("credentials")&&(h.credentials=a.getAttribute("credentials"));
c&&(h.cache="reload");return{xhrUrl:d,fetchOpt:h}})};function M(a,b){this.J=a;this.j=b;this.D=this.C=null}M.prototype.getConfig=function(){var a=this;return 0<this.j.children.length&&!this.j.hasAttribute("src")?N(this):0<this.j.children.length&&this.j.hasAttribute("src")?Promise.race([Promise.resolve().then(function(){return a.fetchConfig()}),Promise.resolve().then(function(){return N(a)})]):this.j.hasAttribute("src")?this.fetchConfig():Promise.resolve({})};
function N(a){if(!(0<a.j.children.length))return Promise.resolve({});if(a.D)return a.D;var b=a.j,c=b.children,d=b.tagName;y(1==c.length,"%s may only have one configuration json <script> tag",d);var e=c[0];return ia(e)?a.D=new Promise(function(b,c){var d=ka(e.textContent,function(a){c(a)});if(!d)return b({});b(O(a,d))}):(w().error(d,'config should be in a <script> tag with type="application/json".'),Promise.resolve({}))}
M.prototype.fetchConfig=function(){return this.j.hasAttribute("src")?this.C?this.C:this.C=na(this):Promise.resolve({})};function na(a){return la(a.J,a.j).then(function(b){return O(a,b)})}function O(a,b){y(!Array.isArray(b)&&"[object Object]"===ea.call(b),"expected %s configuration to be object",a.j.tagName);return b};function P(){this.h=null}P.prototype.add=function(a){var b=this;this.h||(this.h=[]);this.h.push(a);return function(){b.remove(a)}};P.prototype.remove=function(a){this.h&&(a=this.h.indexOf(a),-1<a&&this.h.splice(a,1))};P.prototype.removeAll=function(){this.h&&(this.h.length=0)};P.prototype.fire=function(a){if(this.h)for(var b=this.h,c=0;c<b.length;c++)(0,b[c])(a)};P.prototype.getHandlerCount=function(){return this.h?this.h.length:0};function Q(a,b,c){this.source=a;this.lat=b;this.lon=c};function R(a){this.H=!1;this.w=null;this.I=S(this);this.m=new ba;var b=a.win;this.l=b;a=H(a);a=I(a);var c=G(a,"viewer"),d=J(b,"platform"),e=!(c.isEmbedded()&&d.isChrome());this.L=e&&"geolocation"in b.navigator;this.M="permissions"in b.navigator}function S(a){var b=new P;b.add(function(b){var c=b;a.w=c;a.m&&a.m.resolve(c)});return b}
function oa(a){if(a.M){var b=a.l.navigator.permissions.query({name:"geolocation"});b.then(function(b){b.addEventListener("change",function(b){var c=b.target.state;"granted"!==c&&a.purge()})})}}R.prototype.purge=function(){this.m=this.w=null;this.I=S(this)};R.prototype.getLocation=function(a){a=void 0===a?!1:a;var b=T(this);return b?b.catch(function(a){return 4==a.code?new Q("unsupported"):new Q("unavailable")}):a&&this.m?this.m.promise:this.w?Promise.resolve(this.w):Promise.resolve(new Q("unavailable"))};
R.prototype.getReplacementLocation=function(a,b,c){return this.getLocation(void 0===c?!1:c).then(function(c){if("SOURCE"===b)return c.source;if("LAT"===b)return c.lat;if("LON"===b)return c.lon;y(""===b||"undefined"===typeof b,"The value passed to %s is not valid: %s",a,b);return"geolocation"!==c.source?"":c.lat+","+c.lon})};
R.prototype.requestLocation=function(a){var b=a.fallback,c=T(this);if(c)return c.catch(function(a){return U(a,b)});this.H||(this.H=!0,oa(this));a=pa(this.l,{enableHighAccuracy:!1,maximumAge:a.maximumAge||6E4,timeout:a.timeout||(u().localDev?3E4:5E3)});var d=this.I;a.then(function(a){return d.fire(a)},function(){return d.fire(new Q("unavailable"))});return a.catch(function(a){return U(a,b)})};
function T(a){var b;if(!a.L)return a=Error("geolocation error"),a.code=4,Promise.reject(a);if(b=u(a.l).userLocationOverride)b=a.l,b=!(!b.AMP_CONFIG||!b.AMP_CONFIG.canary)||u(a.l).localDev;b&&/^[\w-,]+$/.test(u(a.l).userLocationOverride)?"error"===u(a.l).userLocationOverride?(a=Error("geolocation simulated error"),a.code=2):(b=u(a.l).userLocationOverride.split(","),a=Number(b[0]),b=Number(b[1]),a=new Q("debug",a,b)):a=null;var c=a;return c?c instanceof Error?Promise.reject(c):Promise.resolve(c):null}
function U(a,b){b&&(a.fallback=new Q("fallback",b.lat,b.lon));return Promise.reject(a)}function pa(a,b){return new Promise(function(c,d){a.navigator.geolocation.getCurrentPosition(function(a){a=a.coords;var b=a.latitude,d=a.longitude;c(new Q("geolocation",b,d))},function(a){var b=Error("geolocation failed");switch(a.code){case a.POSITION_UNAVAILABLE:b.code=2;break;case a.PERMISSION_DENIED:b.code=1;break;case a.TIMEOUT:b.code=3}d(b)},b)})};function V(a){a=AMP.BaseElement.call(this,a)||this;a.B=null;a.G=null;return a}var W=AMP.BaseElement;V.prototype=k(W.prototype);V.prototype.constructor=V;if(p)p(V,W);else for(var X in W)if("prototype"!=X)if(Object.defineProperties){var Y=Object.getOwnPropertyDescriptor(W,X);Y&&Object.defineProperty(V,X,Y)}else V[X]=W[X];V.N=W.prototype;V.prototype.isLayoutSupported=function(a){return"nodisplay"==a};
V.prototype.buildCallback=function(){var a=this;y(D(this.win,"amp-user-location"),'The "amp-user-location" experiment must be enabled to use amp-user-location');this.B=new M(this.getAmpDoc(),this.element);this.G=E(this.element,"action");this.registerAction("request",function(){return qa(a)},100)};V.prototype.layoutCallback=function(){this.B.fetchConfig();return Promise.resolve()};
function qa(a){return Promise.all([ja(a.element),ra(a)]).then(function(a){var b=a[0];return b.requestLocation(a[1])}).then(function(b){Z(a,"approve",b)},function(b){switch(b.code){case 1:Z(a,"deny",z({fallback:b.fallback}));break;default:Z(a,"error",z({fallback:b.fallback}))}})}
function ra(a){return a.B.getConfig().then(function(a){var b=a.fallback;if("string"===typeof b){var d=b.split(",");d={lat:Number(d[0]),lon:Number(d[1])}}"object"===typeof b&&(d={lat:b.lat,lon:b.lon});return{fallback:d,maximumAge:a.maximumAge,precision:a.precision,timeout:a.timeout}}).catch(function(){var b=Error("Failed to parse amp-user-location config. Is it valid JSON?");a.user().error("amp-user-location",b);throw b;})}
function Z(a,b,c){var d=a.win,e="amp-user-location."+b,f={detail:c};Object.assign(f,void 0);"function"==typeof d.CustomEvent?c=new d.CustomEvent(e,f):(d=d.document.createEvent("CustomEvent"),d.initCustomEvent(e,!!f.bubbles,!!f.cancelable,c),c=d);a.G.trigger(a.element,b,c,100)}(function(a){a.registerElement("amp-user-location",V);a.registerServiceForDoc("user-location",R)})(self.AMP);
})});

//# sourceMappingURL=amp-user-location-0.1.js.map
